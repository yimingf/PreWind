<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
    <title>Wind Animation</title>

    <link rel="stylesheet" href="http://js.arcgis.com/3.8/js/esri/css/esri.css">

    <style>
      html,body {
        width:100%;
        height:100%;
        margin: 0;
        padding: 0px 0 0 0;
      }
      #mapCanvas {
        padding:0;
      }
    </style>

    <script>
      var dojoConfig = { 
        paths: {
          plugins: location.pathname.replace(/\/[^/]+$/, "") + "/plugins"
        }
      };
    </script>
    <script src="./lib/assets/js/windy.js"></script>
    <script src="http://js.arcgis.com/3.12compact/"></script>
    <script src="./lib/assets/js/RasterLayer.js"></script>
    <script>
      var map, rasterLayer;
      var canvasSupport;
      require([
        "esri/map", "esri/layers/ArcGISTiledMapServiceLayer", 
        "esri/domUtils", "esri/request",
        "dojo/parser", "dojo/number", "dojo/json", "dojo/dom", 
        "dijit/registry", "esri/layers/WebTiledLayer",
        "esri/config",
        "dojo/domReady!"
      ], function(
        Map, ArcGISTiledMapServiceLayer, 
        domUtils, esriRequest,
        parser, number, JSON, dom, 
        registry, RasterLayer, WebTiledLayer, esriConfig
      ){        
        map = new Map("mapCanvas", {
          center: [10, 61.5],
          zoom: 6,
          basemap: "dark-gray"
        });

        var layersRequest = esriRequest({
          url: './gfs.json',
          content: {},
          handleAs: "json"
        });
        layersRequest.then(
          function(response) {
            console.log(response);
            windy = new Windy({ canvas: rasterLayer._element, data: response });
            redraw();
        }, function(error) {
            console.log("Error: ", error.message);
        });

        function redraw(){
          rasterLayer._element.width = map.width;
          rasterLayer._element.height = map.height;
          windy.stop();
          var extent = map.geographicExtent;
          setTimeout(function(){
            windy.start(
              [[0,0],[map.width, map.height]], 
              map.width, 
              map.height, 
              [[extent.xmin, extent.ymin],[extent.xmax, extent.ymax]]
            );
          },500);
        }
      });
    </script>
  </head>
  
  <body class="">
     <div id="mapCanvas" style="height:100%;">
     </div>
  </body>

</html>